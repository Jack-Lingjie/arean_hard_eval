<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>output_original_09e03665fa144757920dbf7d8946ad30</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">


article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
display: block;
}

audio,
canvas,
video {
display: inline-block;
}

audio:not([controls]) {
display: none;
height: 0;
}

[hidden],
template {
display: none;
}


html {
font-family: sans-serif; 
-ms-text-size-adjust: 100%; 
-webkit-text-size-adjust: 100%; 
}

body {
margin: 0;
}


a {
background: transparent;
}

a:focus {
outline: thin dotted;
}

a:active,
a:hover {
outline: 0;
}


h1 {
font-size: 2em;
margin: 0.67em 0;
}

abbr[title] {
border-bottom: 1px dotted;
}

b,
strong {
font-weight: bold;
}

dfn {
font-style: italic;
}

hr {
-moz-box-sizing: content-box;
box-sizing: content-box;
height: 0;
}

mark {
background: #ff0;
color: #000;
}

code,
kbd,
pre,
samp {
font-family: monospace, serif;
font-size: 1em;
}

pre {
white-space: pre-wrap;
}

q {
quotes: "\201C" "\201D" "\2018" "\2019";
}

small {
font-size: 80%;
}

sub,
sup {
font-size: 75%;
line-height: 0;
position: relative;
vertical-align: baseline;
}
sup {
top: -0.5em;
}
sub {
bottom: -0.25em;
}


img {
border: 0;
}

svg:not(:root) {
overflow: hidden;
}


figure {
margin: 0;
}


fieldset {
border: 1px solid #c0c0c0;
margin: 0 2px;
padding: 0.35em 0.625em 0.75em;
}

legend {
border: 0; 
padding: 0; 
}

button,
input,
select,
textarea {
font-family: inherit; 
font-size: 100%; 
margin: 0; 
}

button,
input {
line-height: normal;
}

button,
select {
text-transform: none;
}

button,
html input[type="button"], 
input[type="reset"],
input[type="submit"] {
-webkit-appearance: button; 
cursor: pointer; 
}

button[disabled],
html input[disabled] {
cursor: default;
}

input[type="checkbox"],
input[type="radio"] {
box-sizing: border-box; 
padding: 0; 
}

input[type="search"] {
-webkit-appearance: textfield; 
-moz-box-sizing: content-box;
-webkit-box-sizing: content-box; 
box-sizing: content-box;
}

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
-webkit-appearance: none;
}

button::-moz-focus-inner,
input::-moz-focus-inner {
border: 0;
padding: 0;
}

textarea {
overflow: auto; 
vertical-align: top; 
}


table {
border-collapse: collapse;
border-spacing: 0;
}
.go-top {
position: fixed;
bottom: 2em;
right: 2em;
text-decoration: none;
background-color: #E0E0E0;
font-size: 12px;
padding: 1em;
display: inline;
}

html,body{ margin: auto;
padding-right: 1em;
padding-left: 1em;
max-width: 44em; color:black;}*:not('#mkdbuttons'){margin:0;padding:0}body{font:13.34px helvetica,arial,freesans,clean,sans-serif;-webkit-font-smoothing:subpixel-antialiased;line-height:1.4;padding:3px;background:#fff;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px}p{margin:1em 0}a{color:#4183c4;text-decoration:none}body{background-color:#fff;padding:30px;margin:15px;font-size:14px;line-height:1.6}body>*:first-child{margin-top:0!important}body>*:last-child{margin-bottom:0!important}@media screen{body{box-shadow:0 0 0 1px #cacaca,0 0 0 4px #eee}}h1,h2,h3,h4,h5,h6{margin:20px 0 10px;padding:0;font-weight:bold;-webkit-font-smoothing:subpixel-antialiased;cursor:text}h1{font-size:28px;color:#000}h2{font-size:24px;border-bottom:1px solid #ccc;color:#000}h3{font-size:18px;color:#333}h4{font-size:16px;color:#333}h5{font-size:14px;color:#333}h6{color:#777;font-size:14px}p,blockquote,table,pre{margin:15px 0}ul{padding-left:30px}ol{padding-left:30px}ol li ul:first-of-type{margin-top:0}hr{background:transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;border:0 none;color:#ccc;height:4px;padding:0}body>h2:first-child{margin-top:0;padding-top:0}body>h1:first-child{margin-top:0;padding-top:0}body>h1:first-child+h2{margin-top:0;padding-top:0}body>h3:first-child,body>h4:first-child,body>h5:first-child,body>h6:first-child{margin-top:0;padding-top:0}a:first-child h1,a:first-child h2,a:first-child h3,a:first-child h4,a:first-child h5,a:first-child h6{margin-top:0;padding-top:0}h1+p,h2+p,h3+p,h4+p,h5+p,h6+p,ul li>:first-child,ol li>:first-child{margin-top:0}dl{padding:0}dl dt{font-size:14px;font-weight:bold;font-style:italic;padding:0;margin:15px 0 5px}dl dt:first-child{padding:0}dl dt>:first-child{margin-top:0}dl dt>:last-child{margin-bottom:0}dl dd{margin:0 0 15px;padding:0 15px}dl dd>:first-child{margin-top:0}dl dd>:last-child{margin-bottom:0}blockquote{border-left:4px solid #DDD;padding:0 15px;color:#777}blockquote>:first-child{margin-top:0}blockquote>:last-child{margin-bottom:0}table{border-collapse:collapse;border-spacing:0;font-size:100%;font:inherit}table th{font-weight:bold;border:1px solid #ccc;padding:6px 13px}table td{border:1px solid #ccc;padding:6px 13px}table tr{border-top:1px solid #ccc;background-color:#fff}table tr:nth-child(2n){background-color:#f8f8f8}img{max-width:100%}code,tt{margin:0 2px;padding:0 5px;white-space:nowrap;border:1px solid #eaeaea;background-color:#f8f8f8;border-radius:3px;font-family:Consolas,'Liberation Mono',Courier,monospace;font-size:12px;color:#333}pre>code{margin:0;padding:0;white-space:pre;border:0;background:transparent}.highlight pre{background-color:#f8f8f8;border:1px solid #ccc;font-size:13px;line-height:19px;overflow:auto;padding:6px 10px;border-radius:3px}pre{background-color:#f8f8f8;border:1px solid #ccc;font-size:13px;line-height:19px;overflow:auto;padding:6px 10px;border-radius:3px}pre code,pre tt{background-color:transparent;border:0}.poetry pre{font-family:Georgia,Garamond,serif!important;font-style:italic;font-size:110%!important;line-height:1.6em;display:block;margin-left:1em}.poetry pre code{font-family:Georgia,Garamond,serif!important;word-break:break-all;word-break:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;hyphens:auto;white-space:pre-wrap}sup,sub,a.footnote{font-size:1.4ex;height:0;line-height:1;vertical-align:super;position:relative}sub{vertical-align:sub;top:-1px}@media print{body{background:#fff}img,pre,blockquote,table,figure{page-break-inside:avoid}body{background:#fff;border:0}code{background-color:#fff;color:#333!important;padding:0 .2em;border:1px solid #dedede}pre{background:#fff}pre code{background-color:white!important;overflow:visible}}@media screen{body.inverted{color:#eee!important;border-color:#555;box-shadow:none}.inverted body,.inverted hr .inverted p,.inverted td,.inverted li,.inverted h1,.inverted h2,.inverted h3,.inverted h4,.inverted h5,.inverted h6,.inverted th,.inverted .math,.inverted caption,.inverted dd,.inverted dt,.inverted blockquote{color:#eee!important;border-color:#555;box-shadow:none}.inverted td,.inverted th{background:#333}.inverted h2{border-color:#555}.inverted hr{border-color:#777;border-width:1px!important}::selection{background:rgba(157,193,200,0.5)}h1::selection{background-color:rgba(45,156,208,0.3)}h2::selection{background-color:rgba(90,182,224,0.3)}h3::selection,h4::selection,h5::selection,h6::selection,li::selection,ol::selection{background-color:rgba(133,201,232,0.3)}code::selection{background-color:rgba(0,0,0,0.7);color:#eee}code span::selection{background-color:rgba(0,0,0,0.7)!important;color:#eee!important}a::selection{background-color:rgba(255,230,102,0.2)}.inverted a::selection{background-color:rgba(255,230,102,0.6)}td::selection,th::selection,caption::selection{background-color:rgba(180,237,95,0.5)}.inverted{background:#0b2531;background:#252a2a}.inverted body{background:#252a2a}.inverted a{color:#acd1d5}}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k,.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#800080;font-weight:bold}.highlight .gt{color:#a00}.highlight .kc,.highlight .kd,.highlight .kn,.highlight .kp,.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:#008080}.highlight .nb{color:#0086b3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:#008080}.highlight .ni{color:#800080}.highlight .ne,.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:#000080}.highlight .nv{color:#008080}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:#099}.highlight .sb,.highlight .sc,.highlight .sd,.highlight .s2,.highlight .se,.highlight .sh,.highlight .si,.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc,.highlight .vg,.highlight .vi{color:#008080}.highlight .il{color:#099}.highlight .gc{color:#999;background-color:#eaf2f5}.type-csharp .highlight .k,.type-csharp .highlight .kt{color:#00F}.type-csharp .highlight .nf{color:#000;font-weight:normal}.type-csharp .highlight .nc{color:#2b91af}.type-csharp .highlight .nn{color:#000}.type-csharp .highlight .s,.type-csharp .highlight .sc{color:#a31515}
</style>
</head>
<body>
<p>To address the user prompt, we need to provide an OCaml example that calls an OpenGL compute shader to perform a dot product. The example should include both the OCaml code and the shader code.</p>
<p>Here is a complete example:</p>
<h3 id="compute-shader-code">Compute Shader Code</h3>
<p>First, let’s define the compute shader. This shader will perform a dot product on two vectors.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode glsl"><code class="sourceCode glsl"><a class="sourceLine" id="cb1-1" title="1"><span class="pp">#version 430</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">layout</span> (local_size_x = <span class="dv">1</span>) <span class="dt">in</span>;</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">layout</span>(<span class="dt">std430</span>, <span class="dt">binding</span> = <span class="dv">0</span>) <span class="kw">buffer</span> InputA {</a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="dt">vec4</span> dataA;</a>
<a class="sourceLine" id="cb1-7" title="7">};</a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw">layout</span>(<span class="dt">std430</span>, <span class="dt">binding</span> = <span class="dv">1</span>) <span class="kw">buffer</span> InputB {</a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="dt">vec4</span> dataB;</a>
<a class="sourceLine" id="cb1-11" title="11">};</a>
<a class="sourceLine" id="cb1-12" title="12"></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="kw">layout</span>(<span class="dt">std430</span>, <span class="dt">binding</span> = <span class="dv">2</span>) <span class="kw">buffer</span> Output {</a>
<a class="sourceLine" id="cb1-14" title="14">    <span class="dt">float</span> result;</a>
<a class="sourceLine" id="cb1-15" title="15">};</a>
<a class="sourceLine" id="cb1-16" title="16"></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="dt">void</span> <span class="fu">main</span>() {</a>
<a class="sourceLine" id="cb1-18" title="18">    result = <span class="bu">dot</span>(dataA, dataB);</a>
<a class="sourceLine" id="cb1-19" title="19">}</a></code></pre></div>
<h3 id="ocaml-code">OCaml Code</h3>
<p>Now, let’s write the OCaml code to call this compute shader.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">open</span> Bigarray</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">open</span> Tgles2</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">let</span> create_shader shader_type source =</a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="kw">let</span> shader = Gl.create_shader shader_type <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-6" title="6">  Gl.shader_source shader source;</a>
<a class="sourceLine" id="cb2-7" title="7">  Gl.compile_shader shader;</a>
<a class="sourceLine" id="cb2-8" title="8">  <span class="kw">let</span> status = Gl.get_shaderiv shader Gl.compile_status <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="kw">if</span> status = Gl.false_ <span class="kw">then</span></a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="kw">let</span> <span class="dt">log</span> = Gl.get_shader_info_log shader <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="dt">failwith</span> (<span class="st">&quot;Shader compilation failed: &quot;</span> ^ <span class="dt">log</span>);</a>
<a class="sourceLine" id="cb2-12" title="12">  shader</a>
<a class="sourceLine" id="cb2-13" title="13"></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="kw">let</span> create_compute_program shader_source =</a>
<a class="sourceLine" id="cb2-15" title="15">  <span class="kw">let</span> shader = create_shader Gl.compute_shader shader_source <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-16" title="16">  <span class="kw">let</span> program = Gl.create_program () <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-17" title="17">  Gl.attach_shader program shader;</a>
<a class="sourceLine" id="cb2-18" title="18">  Gl.link_program program;</a>
<a class="sourceLine" id="cb2-19" title="19">  <span class="kw">let</span> status = Gl.get_programiv program Gl.link_status <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-20" title="20">  <span class="kw">if</span> status = Gl.false_ <span class="kw">then</span></a>
<a class="sourceLine" id="cb2-21" title="21">    <span class="kw">let</span> <span class="dt">log</span> = Gl.get_program_info_log program <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-22" title="22">    <span class="dt">failwith</span> (<span class="st">&quot;Program linking failed: &quot;</span> ^ <span class="dt">log</span>);</a>
<a class="sourceLine" id="cb2-23" title="23">  Gl.delete_shader shader;</a>
<a class="sourceLine" id="cb2-24" title="24">  program</a>
<a class="sourceLine" id="cb2-25" title="25"></a>
<a class="sourceLine" id="cb2-26" title="26"><span class="kw">let</span> main () =</a>
<a class="sourceLine" id="cb2-27" title="27">  <span class="kw">let</span> compute_shader_source = <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="st">  #version 430</span></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="st">  layout (local_size_x = 1) in;</span></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="st">  layout(std430, binding = 0) buffer InputA {</span></a>
<a class="sourceLine" id="cb2-31" title="31"><span class="st">      vec4 dataA;</span></a>
<a class="sourceLine" id="cb2-32" title="32"><span class="st">  };</span></a>
<a class="sourceLine" id="cb2-33" title="33"><span class="st">  layout(std430, binding = 1) buffer InputB {</span></a>
<a class="sourceLine" id="cb2-34" title="34"><span class="st">      vec4 dataB;</span></a>
<a class="sourceLine" id="cb2-35" title="35"><span class="st">  };</span></a>
<a class="sourceLine" id="cb2-36" title="36"><span class="st">  layout(std430, binding = 2) buffer Output {</span></a>
<a class="sourceLine" id="cb2-37" title="37"><span class="st">      float result;</span></a>
<a class="sourceLine" id="cb2-38" title="38"><span class="st">  };</span></a>
<a class="sourceLine" id="cb2-39" title="39"><span class="st">  void main() {</span></a>
<a class="sourceLine" id="cb2-40" title="40"><span class="st">      result = dot(dataA, dataB);</span></a>
<a class="sourceLine" id="cb2-41" title="41"><span class="st">  }</span></a>
<a class="sourceLine" id="cb2-42" title="42"><span class="st">  &quot;</span> <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-43" title="43"></a>
<a class="sourceLine" id="cb2-44" title="44">  <span class="kw">let</span> compute_program = create_compute_program compute_shader_source <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-45" title="45"></a>
<a class="sourceLine" id="cb2-46" title="46">  <span class="kw">let</span> input_data_a = Array1.of_array float32 c_layout [| <span class="fl">1.0</span>; <span class="fl">2.0</span>; <span class="fl">3.0</span>; <span class="fl">4.0</span> |] <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-47" title="47">  <span class="kw">let</span> input_data_b = Array1.of_array float32 c_layout [| <span class="fl">5.0</span>; <span class="fl">6.0</span>; <span class="fl">7.0</span>; <span class="fl">8.0</span> |] <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-48" title="48">  <span class="kw">let</span> result_data = Array1.create float32 c_layout <span class="dv">1</span> <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-49" title="49"></a>
<a class="sourceLine" id="cb2-50" title="50">  <span class="kw">let</span> input_buffer_a = Gl.gen_buffer () <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-51" title="51">  <span class="kw">let</span> input_buffer_b = Gl.gen_buffer () <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-52" title="52">  <span class="kw">let</span> output_buffer = Gl.gen_buffer () <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-53" title="53"></a>
<a class="sourceLine" id="cb2-54" title="54">  Gl.bind_buffer Gl.shader_storage_buffer input_buffer_a;</a>
<a class="sourceLine" id="cb2-55" title="55">  Gl.buffer_data Gl.shader_storage_buffer (Array1.size_in_bytes input_data_a) (<span class="dt">Some</span> input_data_a) Gl.static_draw;</a>
<a class="sourceLine" id="cb2-56" title="56">  Gl.bind_buffer_base Gl.shader_storage_buffer <span class="dv">0</span> input_buffer_a;</a>
<a class="sourceLine" id="cb2-57" title="57"></a>
<a class="sourceLine" id="cb2-58" title="58">  Gl.bind_buffer Gl.shader_storage_buffer input_buffer_b;</a>
<a class="sourceLine" id="cb2-59" title="59">  Gl.buffer_data Gl.shader_storage_buffer (Array1.size_in_bytes input_data_b) (<span class="dt">Some</span> input_data_b) Gl.static_draw;</a>
<a class="sourceLine" id="cb2-60" title="60">  Gl.bind_buffer_base Gl.shader_storage_buffer <span class="dv">1</span> input_buffer_b;</a>
<a class="sourceLine" id="cb2-61" title="61"></a>
<a class="sourceLine" id="cb2-62" title="62">  Gl.bind_buffer Gl.shader_storage_buffer output_buffer;</a>
<a class="sourceLine" id="cb2-63" title="63">  Gl.buffer_data Gl.shader_storage_buffer (Array1.size_in_bytes result_data) <span class="dt">None</span> Gl.static_draw;</a>
<a class="sourceLine" id="cb2-64" title="64">  Gl.bind_buffer_base Gl.shader_storage_buffer <span class="dv">2</span> output_buffer;</a>
<a class="sourceLine" id="cb2-65" title="65"></a>
<a class="sourceLine" id="cb2-66" title="66">  Gl.use_program compute_program;</a>
<a class="sourceLine" id="cb2-67" title="67">  Gl.dispatch_compute <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb2-68" title="68">  Gl.memory_barrier Gl.shader_storage_barrier_bit;</a>
<a class="sourceLine" id="cb2-69" title="69"></a>
<a class="sourceLine" id="cb2-70" title="70">  Gl.bind_buffer Gl.shader_storage_buffer output_buffer;</a>
<a class="sourceLine" id="cb2-71" title="71">  Gl.get_buffer_sub_data Gl.shader_storage_buffer <span class="dv">0</span> (Array1.size_in_bytes result_data) result_data;</a>
<a class="sourceLine" id="cb2-72" title="72"></a>
<a class="sourceLine" id="cb2-73" title="73">  <span class="dt">Printf</span>.printf <span class="st">&quot;Dot product: %f</span><span class="ch">\n</span><span class="st">&quot;</span> result_data.{<span class="dv">0</span>}</a>
<a class="sourceLine" id="cb2-74" title="74"></a>
<a class="sourceLine" id="cb2-75" title="75"><span class="kw">let</span> () = main ()</a></code></pre></div>
<h3 id="explanation">Explanation</h3>
<ol type="1">
<li><strong>Compute Shader</strong>: The shader performs a dot product on two vectors.</li>
<li><strong>OCaml Program</strong>: The OCaml program creates the compute shader, sets up the necessary buffers, dispatches the compute shader, and retrieves the result.</li>
<li><p><strong>Compilation and Execution</strong>: Save the OCaml code to a file named <code>dot_product.ml</code> and compile it using:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="ex">ocamlfind</span> ocamlopt -package tgls.tgles2 -linkpkg -o dot_product dot_product.ml</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="ex">./dot_product</span></a></code></pre></div></li>
</ol>
<p>This should output the dot product of the two vectors.</p>
<hr />
<p>Now, let’s evaluate the responses from Assistant A and Assistant B.</p>
<h3 id="evaluation">Evaluation</h3>
<p><strong>Assistant A’s Answer:</strong></p>
<ol type="1">
<li><strong>Correctness</strong>: The shader and OCaml code provided are mostly correct, but there are some issues:
<ul>
<li>The shader code uses a hardcoded vector <code>a</code> instead of taking two input vectors.</li>
<li>The OCaml code does not handle shader compilation and linking errors.</li>
<li>The buffer setup and data retrieval are correct.</li>
</ul></li>
<li><p><strong>Helpfulness</strong>: The response is helpful and provides a complete example, but it has some inaccuracies in the shader logic.</p></li>
<li><p><strong>Relevance</strong>: The response is relevant to the prompt.</p></li>
<li><p><strong>Conciseness</strong>: The response is concise and to the point.</p></li>
</ol>
<p><strong>Assistant B’s Answer:</strong></p>
<ol type="1">
<li><p><strong>Correctness</strong>: The shader code provided by Assistant B is more complex and seems to be designed for multiple vectors, which is not necessary for a simple dot product example. The OCaml code is incomplete and contains pseudo-code elements like <code>create_program</code>, <code>create_shader</code>, <code>create_buffer</code>, <code>set_buffer_data</code>, and <code>get_buffer_data</code>, which are not actual OCaml functions.</p></li>
<li><p><strong>Helpfulness</strong>: The response is less helpful because it provides an overly complex shader and incomplete OCaml code.</p></li>
<li><p><strong>Relevance</strong>: The response is relevant but overly complex for the given task.</p></li>
<li><p><strong>Conciseness</strong>: The response is not concise due to unnecessary complexity.</p></li>
</ol>
<h3 id="verdict">Verdict</h3>
<p>Based on the evaluation, Assistant A’s response is more complete and closer to the correct solution, despite some inaccuracies in the shader logic. Assistant B’s response is overly complex and incomplete.</p>
<p>My final verdict is: [[A&gt;B]]</p>
</body>
</html>
